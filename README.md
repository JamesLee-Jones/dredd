# Dredd

Dredd is a tool that aims to enable [mutation testing and mutation
analysis](https://en.wikipedia.org/wiki/Mutation_testing) of large C++
code bases. Dredd is named after [Judge
Dredd](https://en.wikipedia.org/wiki/Judge_Dredd), because mutation
analysis can be used to judge the effectiveness of test suites, by
measuring test suite adequacy.

To apply Dredd to a C++ project, you must first generate a
[*compilation
database*](https://clang.llvm.org/docs/JSONCompilationDatabase.html)
for the project: a `compile_commands.json` file. Compilation databases
can be automatically generated by most modern build systems that
support C++ - [here is a great resource on compilation
databases](https://sarcasm.github.io/notes/dev/compilation-database.html).

You then point Dredd at (a) the C++ source files that you would like
to be mutated, and (b) the compilation database, which must provide
entries describing the compile commands that these source files
require.

Dredd will modify the source files in place, injecting a large number
of mutants. By default, each mutant is *disabled* and will have no
effect, so if you execute your project's executables or test suites in
the normal way they should behave normally (albeit running more slowly
due to the overhead of Dredd's instrumentation).

An environment variable, `DREDD_ENABLED_MUTATION`, can be used to
enable a mutant. Setting this environment variable to a non-negative
integer value $i$ will enable mutant number $i$.

In mutation testing parlance, rather than creating mutants, Dredd
creates a *mutant schema* or *meta-mutant*, simultaneously encoding
all the mutants that it *could* generate into the source code of the
program.

## Using Dredd

TODO(https://github.com/mc-imperial/dredd/issues/29): provide support
for Dredd releases (on Linux at least), so that folks can use Dredd
without having to build it from source.


We first show how to apply Dredd to a simple stand-alone program. We will then show how to apply it to a larger C++ CMake project.

Before following these instructions, make sure you have built Dredd and that the `dredd` executable is located under `<repository-root>/third_party/clang+llvm-13.0.1/bin`.

### Applying Dredd to a single file example

`pi.cc` is a small example in `examples/simple` that calculates an approximation of pi. To run this example, run the following from the root of the repository:
```
# This will modify pi.cc in-place.
third_party/clang+llvm-13.0.1/bin/dredd examples/simple/pi.cc
# clang++ can be replaced with your favourite C++ compiler.
clang++ examples/simple/pi.cc -o examples/simple/pi
```
Due to the changes made by Dredd, the compile command may lead to warnings being issued but this is expected.  The changes to `pi.cc` can be viewed by running `git diff` although, these changes are not meant to be human-readable.

Running the executable with no additional arguments via `examples/simple/pi` will produce the expected result of 3.14159.  You can specify which mutants you want to use at runtime by running:
```
DREDD_ENABLED_MUTATION=$i$ examples/simple/pi
```
where $i$ is the id of the mutation in the program generated by Dredd. For example, running `DREDD_ENABLE_MUTATION=2 examples/simple/pi` will enable mutation number 2 in the modified program. 
This may print a different output to the original program and in some cases may not terminate. 
There is a possibility that equivalent mutants are generated which can lead to the printed value being unchanged.

To clean up and restore the file `pi.cc` to it's initial state, run
```
rm examples/simple/pi
git checkout HEAD examples/simple/pi.cc
```

### Applying Dredd to a CMake project

TODO(https://github.com/mc-imperial/dredd/issues/28): add instructions
on how to apply dread to a larger project

## Building Dredd from source

The following instructions have been tested on Ubuntu 20.04.

### Prerequisites

- curl (used to fetch a Clang/LLVM release)
- CMake version 3.13 or higher
- ninja version 1.10.0 or higher

### Clone the repository and get submodules

Either do:

```
git clone --recursive https://github.com/mc-imperial/dredd.git
```

or:

```
git clone --recursive git@github.com:mc-imperial/dredd.git
```

The `--recursive` flag ensures that submodules are fetched.

### Downloading Clang/LLVM

Dredd builds against various Clang and LLVM libraries. Rather than including Clang/LLVM as a submodule of Dredd and building it from source, Dredd assumes that a built release of Clang/LLVM has been downloaded into `third_party`.

From the root of the repository, execute the following commands:

```
cd third_party
# The release file is pretty large, so this download may take a while
curl -Lo clang-13.0.1.tar.xz https://github.com/llvm/llvm-project/releases/download/llvmorg-13.0.1/clang+llvm-13.0.1-x86_64-linux-gnu-ubuntu-18.04.tar.xz
tar xf clang-13.0.1.tar.xz
mv clang+llvm-13.0.1-x86_64-linux-gnu-ubuntu-18.04 clang+llvm-13.0.1
rm clang-13.0.1.tar.xz
cd ..
```

### Build steps

From the root of the repository, execute the following commands.
Change `Debug` to `Release` for a release build.

```
mkdir build && cd build
cmake -G Ninja .. -DCMAKE_BUILD_TYPE=Debug
cmake --build . --config Debug
# TODO: the following should be handled using a proper cmake install command
cp src/dredd/dredd ../third_party/clang+llvm-13.0.1/bin
```

## Guide for developers

TODO(https://github.com/mc-imperial/dredd/issues/31)

## Planned features

See [planned feature
issues](https://github.com/mc-imperial/dredd/issues?q=is%3Aissue+is%3Aopen+label%3Aplanned-feature)
in the Dredd GitHub repository.

If you would like to see a feature added to Dredd, please [open an
issue](https://github.com/mc-imperial/dredd/issues) and we will
consider it.
